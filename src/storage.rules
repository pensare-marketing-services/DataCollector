rules_version = '2';

// Define the security rules for the Firebase Storage service.
// This ruleset is configured to allow public read access for profile images
// while restricting write access to the user who owns the photo.
service firebase.storage {

  // Rules apply to all files within a specified bucket.
  match /b/{bucket}/o {

    // Specifically match the path for user profile photos.
    match /user-photos/{userId}/profile.jpg {

      /**
       * @description Allow public read access to profile photos.
       * This allows anyone to view the images, which is common for profile pictures.
       */
      allow read: if true;
      
      /**
       * @description Allow write access only for the authenticated owner of the photo.
       * The `userId` in the path must match the UID of the user making the request.
       * This is a critical security measure to prevent users from overwriting each other's data.
       */
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
